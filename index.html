<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HydroSense Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <style>
    :root {
      --glass: rgba(255, 255, 255, 0.15);
      --bg-light: linear-gradient(135deg, #74ebd5, #ACB6E5);
      --text-dark: #111;
      --primary: #00bcd4;
      --alert-color: #ff3860;
      --ok-color: #4CAF50;
    }

    body {
      font-family: 'Nunito', sans-serif;
      margin: 0;
      padding: 1rem;
      background: var(--bg-light);
      color: var(--text-dark);
    }

    .card {
      background: var(--glass);
      padding: 1rem;
      border-radius: 12px;
      margin: 1rem auto;
      max-width: 420px;
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .alerts {
      color: var(--alert-color);
      font-weight: bold;
      margin-top: 10px;
      text-align: center;
      animation: blink 1s step-start infinite;
    }

    .status-ok {
      color: var(--ok-color);
      font-weight: bold;
      text-align: center;
      margin-top: 10px;
    }

    canvas {
      margin-top: 1rem;
    }

    @keyframes blink {
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <h2 style="text-align:center">üíß HydroSense Dashboard</h2>

  <div class="card">
    üõ¢Ô∏è <strong>Tank Level:</strong> <span id="tankLevel">--</span>%
    <div id="alertBox" class="alerts"></div>
  </div>

  <div class="card">
    üìà <strong>Tank Level History:</strong>
    <canvas id="tankChart" width="350" height="200"></canvas>
    <button onclick="tankChart.resetZoom()" style="display:block;margin:10px auto;padding:6px 12px;background:#00bcd4;color:#fff;border:none;border-radius:8px;">
      üîÑ Reset Zoom
    </button>
  </div>

  <div class="card">
    üìä <strong>Weekly Water Usage:</strong>
    <canvas id="weeklyUsageChart" width="350" height="200"></canvas>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      databaseURL: "https://YOUR_PROJECT.firebaseio.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const tankEl = document.getElementById("tankLevel");
    const alertBox = document.getElementById("alertBox");

    const tankData = [];
    const tankLabels = [];

    const ctxTank = document.getElementById("tankChart").getContext("2d");
    const tankChart = new Chart(ctxTank, {
      type: 'line',
      data: {
        labels: tankLabels,
        datasets: [{
          label: 'Tank Level (%)',
          data: tankData,
          borderColor: '#00acc1',
          backgroundColor: 'rgba(0,188,212,0.3)',
          fill: true,
          tension: 0.4,
          pointRadius: 3,
          pointBackgroundColor: '#00acc1'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: {
            labels: { color: '#111' }
          },
          zoom: {
            pan: {
              enabled: true,
              mode: 'x',
              modifierKey: 'ctrl'
            },
            zoom: {
              wheel: {
                enabled: true,
              },
              pinch: {
                enabled: true
              },
              mode: 'x'
            }
          }
        },
        scales: {
          x: {
            ticks: { color: '#111' }
          },
          y: {
            beginAtZero: true,
            max: 100,
            ticks: { color: '#111' }
          }
        }
      }
    });

    db.ref("tank").on("value", snap => {
      const val = snap.val();
      tankEl.textContent = val;
      if (val >= 90) {
        alertBox.textContent = "‚ö†Ô∏è Tank Full!";
        alertBox.className = "alerts";
      } else if (val <= 10) {
        alertBox.textContent = "‚ö†Ô∏è Tank Low!";
        alertBox.className = "alerts";
      } else {
        alertBox.textContent = "‚úÖ Tank Level Normal";
        alertBox.className = "status-ok";
      }

      const now = new Date().toLocaleTimeString();
      tankData.push(val);
      tankLabels.push(now);
      if (tankData.length > 30) {
        tankData.shift();
        tankLabels.shift();
      }
      tankChart.update();
    });

    const weeklyUsageData = [80, 65, 70, 90, 60, 75, 85];
    const weeklyLabels = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];

    const ctxWeekly = document.getElementById("weeklyUsageChart").getContext("2d");
    const weeklyUsageChart = new Chart(ctxWeekly, {
      type: 'bar',
      data: {
        labels: weeklyLabels,
        datasets: [{
          label: 'Usage (Liters)',
          data: weeklyUsageData,
          backgroundColor: 'rgba(0, 188, 212, 0.6)',
          borderRadius: 8,
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { display: false }
        },
        scales: {
          x: { ticks: { color: '#111' } },
          y: { beginAtZero: true, ticks: { color: '#111' } }
        }
      }
    });
  </script>
</body>
</html>
