<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>HydroSense Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
  <style>
    :root {
      --glass: rgba(255, 255, 255, 0.15);
      --bg-light: linear-gradient(135deg, #74ebd5, #ACB6E5);
      --bg-dark: linear-gradient(135deg, #1e1e2f, #3c3c5e);
      --text-light: #fff;
      --text-dark: #111;
      --alert-color: #ff3860;
      --ok-color: #4CAF50;
    }

    body {
      font-family: 'Nunito', sans-serif;
      margin: 0;
      padding: 1rem;
      background: var(--bg-light);
      color: var(--text-dark);
      transition: background 0.5s ease;
    }

    body.dark-mode {
      background: var(--bg-dark);
      color: var(--text-light);
    }

    .card {
      background: var(--glass);
      padding: 1rem;
      border-radius: 12px;
      margin: 1rem auto;
      max-width: 440px;
      backdrop-filter: blur(8px);
      box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    .alerts {
      color: var(--alert-color);
      font-weight: bold;
      text-align: center;
      margin-top: 8px;
      animation: blink 1s step-start infinite;
    }

    .status-ok {
      color: var(--ok-color);
      font-weight: bold;
      text-align: center;
      margin-top: 8px;
    }

    canvas {
      margin-top: 1rem;
    }

    table {
      width: 100%;
      margin-top: 10px;
      border-collapse: collapse;
    }

    th, td {
      padding: 6px;
      text-align: center;
      border-bottom: 1px solid #ccc;
    }

    button {
      margin: 10px auto 0;
      padding: 8px 12px;
      background: #00bcd4;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: block;
    }

    body.dark-mode .card {
      color: white;
    }

    body.dark-mode th, body.dark-mode td {
      border-color: #555;
    }

    @keyframes blink {
      50% { opacity: 0.3; }
    }
  </style>
</head>
<body>
  <h2 style="text-align:center">💧 HydroSense Dashboard</h2>

  <div class="card">
    🚿 <strong>Flow Rate:</strong> <span id="flowRate">--</span> L/min<br/>
    🛢️ <strong>Tank Level:</strong> <span id="tankLevel">--</span>%<br/>
    🌱 <strong>Moisture:</strong> <span id="moisture">--</span>%<br/>
    🚰 <strong>Motor:</strong> <button id="toggleMotor">OFF</button>
    <div id="alertBox" class="alerts"></div>
  </div>

  <div class="card">
    📈 <strong>Tank Level History:</strong>
    <canvas id="tankChart" width="350" height="200"></canvas>
    <button onclick="tankChart.resetZoom()">🔄 Reset Zoom</button>
  </div>

  <div class="card">
    📊 <strong>Weekly Water Usage:</strong>
    <canvas id="weeklyUsageChart" width="350" height="200"></canvas>
  </div>

  <div class="card">
    🧾 <strong>Last 5 Records:</strong>
    <table id="historyTable">
      <tr><th>Date</th><th>Flow</th><th>Tank</th><th>Moist</th></tr>
    </table>
  </div>

  <div style="text-align:center;">
    <button id="themeToggle">🌓 Toggle Theme</button>
  </div>

  <script>
    const tankEl = document.getElementById("tankLevel");
    const flowEl = document.getElementById("flowRate");
    const moistEl = document.getElementById("moisture");
    const alertBox = document.getElementById("alertBox");
    const toggleMotorBtn = document.getElementById("toggleMotor");
    const themeToggleBtn = document.getElementById("themeToggle");

    let motor = false;
    let history = [];

    toggleMotorBtn.onclick = () => {
      motor = !motor;
      toggleMotorBtn.textContent = motor ? "ON" : "OFF";
    };

    themeToggleBtn.onclick = () => {
      document.body.classList.toggle("dark-mode");
    };

    const tankData = [], tankLabels = [];

    const ctxTank = document.getElementById("tankChart").getContext("2d");
    const tankChart = new Chart(ctxTank, {
      type: 'line',
      data: {
        labels: tankLabels,
        datasets: [{
          label: 'Tank Level (%)',
          data: tankData,
          borderColor: '#00acc1',
          backgroundColor: 'rgba(0,188,212,0.3)',
          fill: true,
          tension: 0.4,
          pointRadius: 3,
          pointBackgroundColor: '#00acc1'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          legend: { labels: { color: '#111' } },
          zoom: {
            pan: { enabled: true, mode: 'x', modifierKey: 'ctrl' },
            zoom: {
              wheel: { enabled: true },
              pinch: { enabled: true },
              mode: 'x'
            }
          }
        },
        scales: {
          x: { ticks: { color: '#111' } },
          y: { beginAtZero: true, max: 100, ticks: { color: '#111' } }
        }
      }
    });

    const ctxWeekly = document.getElementById("weeklyUsageChart").getContext("2d");
    const weeklyUsageChart = new Chart(ctxWeekly, {
      type: 'bar',
      data: {
        labels: ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'],
        datasets: [{
          label: 'Usage (Liters)',
          data: [80, 65, 70, 90, 60, 75, 85],
          backgroundColor: 'rgba(0, 188, 212, 0.6)',
          borderRadius: 8
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { color: '#111' } },
          y: { beginAtZero: true, ticks: { color: '#111' } }
        }
      }
    });

    function updateData() {
      const flow = (Math.random() * 5).toFixed(1);
      const tank = Math.floor(Math.random() * 100);
      const moist = Math.floor(Math.random() * 100);

      flowEl.textContent = flow;
      tankEl.textContent = tank;
      moistEl.textContent = moist;

      const now = new Date().toLocaleTimeString();
      tankData.push(tank);
      tankLabels.push(now);
      if (tankData.length > 30) {
        tankData.shift();
        tankLabels.shift();
      }
      tankChart.update();

      if (tank >= 90) {
        alertBox.textContent = "⚠️ Tank Full!";
        alertBox.className = "alerts";
      } else if (tank <= 10) {
        alertBox.textContent = "⚠️ Tank Low!";
        alertBox.className = "alerts";
      } else {
        alertBox.textContent = "✅ Tank Level Normal";
        alertBox.className = "status-ok";
      }

      const today = new Date().toLocaleDateString();
      history.unshift({ date: today, flow, tank, moist });
      renderTable();
    }

    function renderTable() {
      const table = document.getElementById("historyTable");
      table.innerHTML = "<tr><th>Date</th><th>Flow</th><th>Tank</th><th>Moist</th></tr>";
      history.slice(0, 5).forEach(row => {
        table.innerHTML += `<tr>
          <td>${row.date}</td>
          <td>${row.flow}</td>
          <td>${row.tank}</td>
          <td>${row.moist}</td>
        </tr>`;
      });
    }

    updateData();
    setInterval(updateData, 5000);
  </script>
</body>
</html>
